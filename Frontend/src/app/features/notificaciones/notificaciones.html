<app-header></app-header>

<body class="flex items-center justify-center">
    <div class="w-[95%] md:w-[90%] 2xl:w-[85%] p-6 md:p-10">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-4xl font-bold">Notificaciones</h1>
            <p-button class="filtros" label="Limpiar filtros" [outlined]="true" icon="pi pi-filter-slash"
                (onClick)="clear(dt2)" />
        </div>
        <div class="overflow-hidden rounded-[15px] mt-4 mb-4">

            <!-- TABLA -->
            <p-table #dt2 [value]="notificaciones()" dataKey="id" [rows]="10" [loading]="loading" [paginator]="true"
                [globalFilterFields]="['titulo', 'descripcion', 'estadoNotificacion', 'fecha']"
                [tableStyle]="{ 'min-width': '75rem' }" styleClass="p-datatable-striped">

                <!-- HEADER DE COLUMNAS -->
                <ng-template #header>
                    <tr>
                        <th style="width:5%"><i class="th pi pi-eye"></i></th>
                        <th style="width:15%" class="th">Tipo</th>
                        <th style="width:45%" class="th">Asunto</th>
                        <th style="width:20%" class="th">Fecha</th>
                        <th style="width:15%" class="th"></th>
                    </tr>
                    <!-- FILTROS -->
                    <tr>
                        <th>
                            <p-columnFilter type="boolean" field="leido"></p-columnFilter>
                        </th>

                        <th>
                            <p-columnFilter field="estadoNotificacion" matchMode="equals" [showMenu]="false">
                                <ng-template #filter let-value let-filter="filterCallback">
                                    <p-select [options]="tipos" (onChange)="filter($event.value)" placeholder="Todos"
                                        [showClear]="true" appendTo="body" class="w-full">
                                        <ng-template let-option #item>
                                            <p-tag [value]="option.value" [severity]="getSeverity(option.value)" />
                                        </ng-template>
                                    </p-select>
                                </ng-template>
                            </p-columnFilter>
                        </th>

                        <th>
                            <p-columnFilter type="text" field="titulo" placeholder="Buscar por título..."
                                ariaLabel="Filtro titulo" filterOn="input" matchMode="contains"></p-columnFilter>
                        </th>

                        <th>
                            <p-columnFilter type="date" field="fecha" display="menu" placeholder="Busca por fecha"
                                ariaLabel="Filtero fecha"></p-columnFilter>
                        </th>

                        <th>
                            <!-- Celda vacía para eliminar notificación -->
                        </th>
                    </tr>
                </ng-template>

                <!-- NOTIFICACIONES -->
                <ng-template #body let-notificacion>
                    <tr class="cursor-pointer hover:bg-gray-100 transition-colors" [pRowToggler]="notificacion"
                        [class.font-bold]="!notificacion.leido">

                        <td class="text-center">
                            @if (notificacion.leido) {
                            <i class="pi pi-circle text-green-900" pTooltip="Leída"></i>
                            } @else {
                            <i class="pi pi-circle-fill text-green-900" pTooltip="No leída"></i>
                            }
                        </td>

                        <td>
                            <p-tag [severity]="getSeverity(notificacion.estadoNotificacion)"
                                [value]="notificacion.estadoNotificacion"></p-tag>
                        </td>

                        <td>
                            <div class="flex flex-col">
                                <span class="text-lg">{{ notificacion.titulo }}</span>
                                <span class="text-sm text-gray-500 font-normal">{{ notificacion.descripcion }}</span>
                            </div>
                        </td>

                        <td>
                            <span>{{ notificacion.fecha | date:'dd/MM/yyyy' }}</span>
                        </td>

                        <td (click)="$event.stopPropagation()">
                            <p-button class="eliminar" icon="pi pi-trash" [text]="true" severity="danger" pTooltip="Eliminar"
                                (onClick)="eliminarNotificacion(notificacion)" />
                        </td>
                    </tr>
                </ng-template>

                <!-- DESCRIPCIÓN OCULTA -->
                <ng-template #rowexpansion let-notificacion>
                    <tr>
                        <td colspan="5">
                            <div class="p-4 bg-gray-50 border-l-4 border-gray-300 ml-4 rounded-r-md">
                                <h4 class="font-bold text-gray-700 mb-2">Descripción:</h4>
                                <p class="text-gray-600 text-base leading-relaxed">{{ notificacion.descripcion }}</p>
                            </div>
                        </td>
                    </tr>
                </ng-template>

                <ng-template #emptymessage>
                    <tr>
                        <td colspan="5" class="text-center p-8 text-gray-500">
                            <i class="pi pi-inbox text-4xl mb-2 block"></i>No se han encontrado notificaciones.
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>
</body>

<app-footer></app-footer>

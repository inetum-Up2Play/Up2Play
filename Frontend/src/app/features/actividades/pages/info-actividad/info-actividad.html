<app-header></app-header>
<div
    class="overflow-hidden grid grid-cols-1 lg:grid-cols-2  xl:grid-cols-2 lg:gap-10 xl:gap-10  sm:gap-5 md:gap-5  
    p-12 sm:p-14 md:p-16 lg:p-25 mx-2 sm:mx-4 md:mx-6 lg:mx-auto xl:mx-auto lg:max-w-6xl my-4 sm:my-6 md:my-10 bg-white rounded-lg shadow-lg">

    @let act = actividad();
    @if (act) {
    <div class="lg:pr-10">
        <h1 class="text-4xl font-bold mb-2 wrap-break-word">{{ act.nombre }}</h1>
        <p class="mb-4 text-sm flex items-center gap-2">Creado por
            <img [src]="avatarIdCreador()| avatarImg" alt="avatarCreador" class="max-w-8">
            {{act.usuarioCreadorNombre}}
        </p><br>

        <p><i class="pi pi-trophy" style="color:#3D6C3F"></i>
            <span class="font-bold"> Deporte: </span>{{ act.deporte }}
        </p><br>

        <p class="mb-6 text-justify wrap-break-word">{{ act.descripcion }}</p>

        <div class="space-y-6 mb-6">
            <div class="flex items-center space-x-1">
                <p><i class="pi pi-chart-line" style="color:#3D6C3F"></i>
                    <strong class="mr-1"> Nivel: </strong>

                <form [formGroup]="formRating" class="ml-2">
                    <p-rating formControlName="rating" [readonly]="true">
                        <ng-template #onicon>
                            <i class="pi pi-flag-fill"></i>
                        </ng-template>
                        <ng-template #officon>
                            <i class="pi pi-flag"></i>
                        </ng-template>
                    </p-rating>
                </form>
            </div>

            <p class="wrap-break-word"><i class="pi pi-map-marker" style="color:#3D6C3F"></i>
                <strong> Punto de encuentro:</strong> {{ act.ubicacion }}
            </p>
            <p><i class="pi pi-euro" style="color:#3D6C3F"></i>
                <strong> Precio:</strong> {{ act.precio == 0 ? 'Gratuita' : act.precio + '€' }}
            </p>
        </div>

        <div>
            <p-toast />
            <p-confirmdialog />
            @if (isCreador() && act.estado === 'PENDIENTE') {
            <button (click)="goEditar()"
                class="cursor-pointer bg-[#B1DF75] hover:bg-[#9ecc63] text-black font-bold py-2 px-4 rounded-3xl">
                <i class="pi pi-pen-to-square"></i>
                Editar
            </button>
                @if(act.precio == 0.00) {
                    <button (click)="eliminar($event)"
                        class="cursor-pointer bg-[#9d0208] hover:bg-[#6a040f] text-white font-bold ml-4 py-2 px-4 rounded-3xl">
                        <i class="pi pi-trash"></i>
                        Eliminar
                    </button>
                    
                } @else {
                    
                    <button (click)="reembolsoATodos()"
                        class="cursor-pointer bg-[#9d0208] hover:bg-[#6a040f] text-white font-bold ml-4 py-2 px-4 rounded-3xl">
                        <i class="pi pi-trash"></i>
                        Eliminar y reembolsar
                    </button>
                }
            
            } @else if (!apuntado() && (act.estado === 'PENDIENTE')) {

                 @if (act.numPersInscritas < act.numPersTotales) {

                     @if (act.precio == 0.00) {
                         
                         <button (click)="apuntarse()"
                             class="cursor-pointer bg-lime-800 hover:bg-lime-700 text-white font-bold py-2 px-4 rounded-3xl">
                             ¡Apúntate!
                         </button>
     
                     } @else {
                         <button (click)="pagar()"
                             class="cursor-pointer 
                                 bg-[#FFEE59] hover:bg-[#e6d600] 
                                 text-[#152614] 
                                 font-semibold border-none py-2 px-4 rounded-[20px] 
                                 flex items-center gap-2 shadow-md hover:shadow-lg transition-all">
                             <i class="pi pi-credit-card"></i> 
                             <span>Apúntate por {{ act.precio }}€</span>
                         </button>
     
                     }
                } @else {
                        
                        @if (act.precio == 0.00) {
                            
                            <button (click)="actCompleta()"
                                class="cursor-pointer bg-lime-800 hover:bg-lime-700
                                 text-white font-bold py-2 px-4 rounded-3xl">
                                Actividad Completa
                            </button>
        
                        } @else {
                            <button (click)="actCompleta()"
                                class="cursor-pointer 
                                    bg-[#FFEE59] hover:bg-[#e6d600] text-[#152614] 
                                    font-semibold border-none py-2 px-4 rounded-[20px] 
                                    flex items-center gap-2 shadow-md hover:shadow-lg transition-all">
                                <i class="pi pi-credit-card"></i> 
                                <span>Actividad Completa</span>
                            </button>
    
                        }
                    }

            } @else if (act.estado === 'PENDIENTE') {
                @if (act.precio == 0.00) {
                    <button (click)="desapuntarse()"
                        class="cursor-pointer bg-neutral-600 hover:bg-neutral-500 text-white font-bold py-2 px-4 rounded-3xl">
                        Desapúntate...
                    </button>
                    
                } @else {
                    @if(noReembolso(act.fecha)) {
                        <button (click)="desapuntarse()"
                            class="cursor-pointer 
                                bg-[#d97706] hover:bg-[#b45309] 
                                text-[#F7F7F7] 
                                font-semibold border-none py-2 px-4 rounded-[20px] 
                                transition-all duration-200 
                                hover:shadow-[0_4px_8px_rgba(0,0,0,0.15)]">
                            Desapuntarse sin reembolso
                        </button>
                        
                    } @else {
                        <button (click)="desapuntarse()"
                            class="cursor-pointer 
                                bg-[#d97706] hover:bg-[#b45309] 
                                text-[#F7F7F7] 
                                font-semibold border-none py-2 px-4 rounded-[20px] 
                                transition-all duration-200 
                                hover:shadow-[0_4px_8px_rgba(0,0,0,0.15)]">
                            Desapuntarse y reembolsar...
                        </button>
                    }
                }
            }
        </div>
    </div>

    <div class="mt-8 lg:mt-0">
        <img class="rounded-md mb-6 w-full aspect-video sm:aspect-3/2 object-cover lg:max-w-full"
            [src]="act.deporte | deporteImg" alt="actividad-img">

        <p-card class="w-full">
            <p><strong>Fecha</strong><br>{{ extraerFecha(act.fecha) }}</p>
            <p-divider></p-divider>
            <p><strong>Hora</strong><br>{{ extraerHora(act.fecha) }}</p>
        </p-card>

        <div class="mt-4">
            <p class="font-semibold">Personas inscritas {{ avataresUsuarios().length }} / {{ act.numPersTotales }}</p>
            <div class="flex mt-2 space-x-2">
            </div>
        </div>

        <div class="card flex pt-2 w-full">
            <p-avatar-group>
                @for (participante of avataresUsuarios().slice(0, 5); track $index) {
                <p-avatar [image]="participante.avatarId | avatarImg" [pTooltip]="participante.nombre"
                    tooltipPosition="bottom" shape="circle" size="large"
                    styleClass="border-2 border-white cursor-pointer" />
                }

                @if (avataresUsuarios().length > 5) {
                <p-avatar [label]="'+' + (avataresUsuarios().length - 5)" shape="circle" size="large"
                    styleClass="border-2 border-white bg-slate-200 text-slate-700 font-semibold" />
                }
            </p-avatar-group>
        </div>
    </div>


    <div class="my-8 min-w-xs lg:col-span-full">
        <div id="map" style="height: 400px;" [class.error-map]="errorUbicacion()">

            @if (errorUbicacion()) {
            <img src="https://cdn-icons-png.flaticon.com/512/684/684908.png" alt="error mapa"
                style="width: 80px; height: 80px; display: block; margin: 0 auto;"><br>
            <p class="error-text">{{ errorUbicacion() }}</p>
            } @else {
            <ng-container #mapa>
            </ng-container>
            }

        </div>
    </div>
    }
</div>
<app-footer></app-footer>